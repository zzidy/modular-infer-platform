# Platform-is-all-you-need

dev分支为当前开发分支，待开发完毕将合入主分支
*********************************************************************************************
# 本项目是什么？
本项目旨在提供一个模块化、可扩展的深度模型推理平台，用于快速开发模型推理应用。提供了配置文件、预处理、模型推理、后处理、多线程、视频等模型推理时使用的模块，可供用户自由地编写业务代码，快速开发出自定义的模型推理应用。
目前支持CV的ONNX模型推理。
# 本项目该如何使用？
  1. 首先安装本项目所需的其他软件：OpenCv
  2. 新建build目录，并在build目录中执行
     ```sh
     cmake .. && make -j 8
     ```
     编译好的动态库存放在`install/lib`下，可执行文件存放在`install/bin`下。
  1. 通过`./Platform`即可执行

# 如何编写自己的业务代码？
  在`src/My_Task`下仿照`TaskTest`写好自己的业务代码，然后按照注释提示修改`src/My_Task/CMakeLists.txt`，编译自己刚写好的业务代码并执行`make install`，即可通过`./Platform`运行自己的业务代码。
  我会在`src/My_Task`下提供一些demo参考。

# 现有功能：
  * **业务库实现动态加载**，无需每次修改业务代码就编译整个项目，且能自动安装。
  * **config模块**，可以从配置文件中读取配置。
  * **预处理模块**：实现了图片到图片的预处理，包括图像变形缩放等功能。
# 预计功能（开发中）：
  * **日志log模块**
  * **模型加载推理模块**：包含rknn、onnx、tensorrt等模型的推理
  * **后处理模块**：包括yolo算法的后处理，行为iou检测、追踪模块、个体识别等功能。
  * **视频模块**：包括提供图片切片、视频显示和视频转发的功能。
  * **多线程模块**
  * **模型转换模块**：调用python脚本将模型转换成rknn等模型。
  * **单元测试模块**：gtest架构
  * **相机模块**：支持USB摄像头、监控摄像头等的实时输入。
  * **python脚本执行模块**：可以执行python脚本。
  * **保存结果模块**：可以保存每次执行的结果。



*********************************************************************************************

# 项目中使用的软件版本如下：
* **opencv**：3.4.5

********************************************************************************************

# 模块功能介绍：
* **Task**：该模块为业务模块。如果要编写自己的业务代码，需要继承`TaskBase`类，并重写CreateTask函数。在框架代码Platform中使用了动态加载业务库，每次无需编译完整的框架代码，仅需要编译业务动态库。`TaskBase`中提供了三个函数，分别是`PreTask`、`DoTask`和`PostTask`。将自己的业务代码按照性质分类，分别放入继承类对应函数中。
* **Config**：该模块提供配置文件的统一管理，可从配置文件中读取参数。`ConfigManager`使用单例模式设计，用于提供全局唯一的配置文件管理者。该管理者有一个存储`ConfigBase`智能指针的map，一个添加配置文件的工厂函数`AddConfig`，以及可以获得Config实例的`GetConfig`。当前`ConfigBase`仅实现了`ConfigCSV`类，该类要求配置文件的格式为`Group,Name,Type,Value`，支持的`Type`参数有`string,int,double,bool` 。
* **PreProcess**：该模块为预处理模块，负责对输入模型的数据做预处理。`PreProcessMan`使用单例模式设计，用于提供全局唯一的预处理管理者。该管理者有一个存储空智能指针的map，一个添加预处理文件的工厂函数`AddPreProcess`，以及可以获得PreProcess实例的`GetPreProcess`。`PreProcess`类采用模板设计，目前仅支持`PreProcess<cv::Mat, cv::Mat>`的特化模板，即只支持图片输入，图片输出的预处理操作。
* **ModelInfer**：该模块为模型推理模块，目前支持rknn、onnx模型的推理。
